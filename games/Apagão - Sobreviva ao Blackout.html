<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Apagão: Sobreviva ao Blackout</title>
    <style>
        body { margin: 0; background: #050505; color: white; overflow: hidden; font-family: sans-serif; }
        canvas { display: block; cursor: crosshair; }
        #ui { position: absolute; top: 20px; left: 20px; pointer-events: none; }
        .stat { margin-bottom: 10px; font-size: 18px; text-shadow: 2px 2px #000; }
        #battery-bar { width: 200px; height: 10px; border: 1px solid #fff; }
        #battery-fill { width: 100%; height: 100%; background: #00ff00; transition: width 0.3s; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat">BATERIA</div>
    <div id="battery-bar"><div id="battery-fill"></div></div>
    <div class="stat" style="margin-top:10px">OBJETIVO: Encontre o Gerador (Quadrado Verde)</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const batteryFill = document.getElementById('battery-fill');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const player = {
    x: 100, y: 100,
    size: 15,
    angle: 0,
    battery: 100,
    speed: 3
};

const keys = {};
const obstacles = [
    {x: 300, y: 100, w: 50, h: 300},
    {x: 500, y: 400, w: 300, h: 50},
    {x: 100, y: 500, w: 200, h: 20},
];

const goal = { x: canvas.width - 100, y: canvas.height - 100, size: 30 };

window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
window.addEventListener('mousemove', e => {
    player.angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
});

function update() {
    if(player.battery <= 0) return;

    if (keys['w']) player.y -= player.speed;
    if (keys['s']) player.y += player.speed;
    if (keys['a']) player.x -= player.speed;
    if (keys['d']) player.x += player.speed;

    // Consumo de bateria
    player.battery -= 0.05;
    batteryFill.style.width = player.battery + "%";
    if(player.battery < 30) batteryFill.style.background = "red";

    // Checar vitória
    const dist = Math.hypot(player.x - goal.x, player.y - goal.y);
    if(dist < 30) alert("Energia Restaurada! Você sobreviveu.");
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. Desenhar o "Mundo Escuro"
    ctx.fillStyle = "#111";
    obstacles.forEach(obs => ctx.fillRect(obs.x, obs.y, obs.w, obs.h));
    
    // Objetivo (escondido na escuridão)
    ctx.fillStyle = "#0f0";
    ctx.fillRect(goal.x, goal.y, goal.size, goal.size);

    // 2. Efeito de Lanterna (Máscara de Luz)
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(player.x, player.y);
    
    // Criar o cone de luz baseado no ângulo do mouse
    const beamAngle = 0.5; // Largura do feixe
    const beamLen = player.battery > 0 ? 400 : 0; // Alcance depende da bateria
    
    ctx.arc(player.x, player.y, beamLen, player.angle - beamAngle, player.angle + beamAngle);
    ctx.lineTo(player.x, player.y);
    ctx.clip();

    // Tudo dentro deste clip é o que a lanterna ilumina
    ctx.fillStyle = "rgba(255, 255, 200, 0.1)"; 
    ctx.fillRect(0,0, canvas.width, canvas.height);
    
    // Redesenhar obstáculos e player com brilho
    ctx.fillStyle = "#444";
    obstacles.forEach(obs => ctx.fillRect(obs.x, obs.y, obs.w, obs.h));
    ctx.fillStyle = "#fff";
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.size, 0, Math.PI*2);
    ctx.fill();
    
    ctx.restore();

    // 3. Overlay de escuridão total (onde a luz não chega)
    ctx.globalCompositeOperation = 'multiply';
    ctx.fillStyle = player.battery > 0 ? '#000' : '#000'; 
    // (Simulação simples: no código real usaríamos um gradiente radial invertido)
    
    requestAnimationFrame(() => {
        update();
        draw();
    });
}

draw();
</script>
</body>
</html>