<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rodovia Infinita: Turbo Edition</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #222;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            user-select: none;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            background-color: #333;
        }
        canvas {
            background-color: #555;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        /* UI Overlay */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Deixa clicar no canvas */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #hud {
            width: 380px;
            display: flex;
            justify-content: space-between;
            padding: 10px;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 2px #000;
        }
        .money-text { color: #ffd700; }
        
        /* Menus */
        .menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #fff;
            pointer-events: auto;
            min-width: 300px;
        }
        .hidden { display: none; }
        button {
            background: #ff4757;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 5px;
            margin: 5px;
            transition: 0.2s;
        }
        button:hover { background: #ff6b81; }
        button:disabled { background: #555; cursor: not-allowed; }
        
        /* Shop Styles */
        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .shop-item {
            background: #444;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #666;
        }
        .selected { border-color: #00ff00; background: #2f4f2f; }
        h2 { margin-top: 0; color: #ff4757; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-layer">
        <div id="hud">
            <span>Pontos: <span id="scoreDisplay">0</span></span>
            <span class="money-text">R$: <span id="moneyDisplay">0</span></span>
        </div>

        <div id="startMenu" class="menu">
            <h1>üèéÔ∏è Rodovia Infinita</h1>
            <p>Desvie dos carros e colete moedas!</p>
            <button onclick="startGame()">JOGAR</button>
            <button onclick="openShop()">GARAGEM & UPGRADES</button>
        </div>

        <div id="gameOverMenu" class="menu hidden">
            <h2>üí• CRASH!</h2>
            <p>Pontua√ß√£o: <span id="finalScore">0</span></p>
            <p>Dinheiro ganho: R$ <span id="earnedMoney">0</span></p>
            <button onclick="startGame()">TENTAR DE NOVO</button>
            <button onclick="returnToMenu()">MENU</button>
        </div>

        <div id="shopMenu" class="menu hidden">
            <h2>üîß Garagem</h2>
            <p>Saldo: R$ <span id="shopMoney">0</span></p>
            
            <h3>Carros</h3>
            <div class="shop-grid" id="carList"></div>
            
            <h3>Upgrades</h3>
            <div class="shop-item">
                <p>Multiplicador de Grana (N√≠vel <span id="mulLevel">1</span>)</p>
                <p>Custo: R$ <span id="mulCost">100</span></p>
                <button onclick="buyUpgrade()" id="btnUpgrade">Melhorar</button>
            </div>

            <button onclick="returnToMenu()" style="margin-top:15px; background:#444;">VOLTAR</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Configura√ß√£o da Tela
    const GAME_WIDTH = 400;
    const GAME_HEIGHT = 600;
    
    function resize() {
        // Mant√©m a propor√ß√£o mas ajusta ao tamanho da janela se necess√°rio
        let scale = Math.min(window.innerWidth / GAME_WIDTH, window.innerHeight / GAME_HEIGHT);
        canvas.width = GAME_WIDTH;
        canvas.height = GAME_HEIGHT;
    }
    resize();
    
    // --- ESTADO DO JOGO ---
    let gameState = 'MENU'; // MENU, PLAYING, GAMEOVER, SHOP
    let score = 0;
    let money = 0; // Dinheiro da sess√£o atual
    let gameSpeed = 5;
    let frameCount = 0;
    let animationId;

    // --- DADOS SALVOS (LocalStorage) ---
    let playerData = JSON.parse(localStorage.getItem('runnerData')) || {
        totalMoney: 0,
        unlockedCars: [0], // IDs dos carros comprados
        selectedCar: 0,
        moneyMultiplier: 1
    };

    function saveData() {
        localStorage.setItem('runnerData', JSON.stringify(playerData));
        updateShopUI();
    }

    // --- DEFINI√á√ÉO DE CARROS ---
    const CARS = [
        { id: 0, name: "Sedan B√°sico", color: "#3498db", price: 0, speedBonus: 0 },
        { id: 1, name: "T√°xi Veloz", color: "#f1c40f", price: 500, speedBonus: 1 },
        { id: 2, name: "Esportivo Vermelho", color: "#e74c3c", price: 1500, speedBonus: 2 },
        { id: 3, name: "Tanque Roxo", color: "#9b59b6", price: 3000, speedBonus: 0.5 }, // Menos √°gil, mas estiloso
        { id: 4, name: "Cyber Truck", color: "#bdc3c7", price: 5000, speedBonus: 3 }
    ];

    // --- OBJETOS DO JOGO ---
    let player = {
        x: GAME_WIDTH / 2 - 20,
        y: GAME_HEIGHT - 100,
        width: 40,
        height: 70,
        color: '#3498db',
        velX: 0
    };

    let obstacles = [];
    let lanes = [70, 155, 240, 325]; // Posi√ß√µes X das pistas (aprox)

    // Controles
    let keys = { ArrowLeft: false, ArrowRight: false };

    document.addEventListener('keydown', e => {
        if(keys.hasOwnProperty(e.code)) keys[e.code] = true;
    });
    document.addEventListener('keyup', e => {
        if(keys.hasOwnProperty(e.code)) keys[e.code] = false;
    });

    // --- L√ìGICA DO JOGO ---

    function startGame() {
        gameState = 'PLAYING';
        score = 0;
        money = 0;
        gameSpeed = 5 + (CARS[playerData.selectedCar].speedBonus);
        obstacles = [];
        player.x = GAME_WIDTH / 2 - 20;
        
        // Configura visual do jogador
        player.color = CARS[playerData.selectedCar].color;

        document.getElementById('startMenu').classList.add('hidden');
        document.getElementById('gameOverMenu').classList.add('hidden');
        document.getElementById('shopMenu').classList.add('hidden');
        
        if (animationId) cancelAnimationFrame(animationId);
        loop();
    }

    function spawnObstacle() {
        const lane = lanes[Math.floor(Math.random() * lanes.length)];
        obstacles.push({
            x: lane - 20, // Centraliza na pista
            y: -100,
            width: 40,
            height: 70,
            color: Math.random() > 0.5 ? '#8e44ad' : '#27ae60', // Cores dos inimigos
            speed: Math.random() * 2 + 3 // Velocidade vari√°vel
        });
    }

    function update() {
        frameCount++;
        score++;
        
        // Aumenta dificuldade gradualmente
        if (frameCount % 500 === 0) gameSpeed += 0.5;

        // Movimento do Player
        if (keys.ArrowLeft && player.x > 20) player.x -= 7;
        if (keys.ArrowRight && player.x < GAME_WIDTH - 60) player.x += 7;

        // Gerar Obst√°culos
        if (frameCount % 60 === 0) {
            spawnObstacle();
        }

        // Atualizar Obst√°culos
        for (let i = 0; i < obstacles.length; i++) {
            let obs = obstacles[i];
            obs.y += gameSpeed; // O obst√°culo desce (ilus√£o de movimento)

            // Colis√£o
            if (
                player.x < obs.x + obs.width &&
                player.x + player.width > obs.x &&
                player.y < obs.y + obs.height &&
                player.y + player.height > obs.y
            ) {
                gameOver();
                return; // Para o update
            }

            // Remover se saiu da tela e dar dinheiro
            if (obs.y > GAME_HEIGHT) {
                obstacles.splice(i, 1);
                i--;
                money += 1 * playerData.moneyMultiplier; // Ganha $ ao desviar
            }
        }

        // HUD
        document.getElementById('scoreDisplay').innerText = Math.floor(score / 10);
        document.getElementById('moneyDisplay').innerText = (playerData.totalMoney + money).toFixed(0);
    }

    function draw() {
        // Limpar tela (estrada)
        ctx.fillStyle = "#555";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Desenhar faixas
        ctx.fillStyle = "#fff";
        for (let i = 0; i < 20; i++) {
            // Linha esquerda
            ctx.fillRect(10, (i * 60 + frameCount * gameSpeed) % GAME_HEIGHT - 30, 5, 30);
            // Linha direita
            ctx.fillRect(GAME_WIDTH - 15, (i * 60 + frameCount * gameSpeed) % GAME_HEIGHT - 30, 5, 30);
            // Linhas pontilhadas do meio
            ctx.fillRect(GAME_WIDTH / 3, (i * 60 + frameCount * gameSpeed) % GAME_HEIGHT - 30, 2, 20);
            ctx.fillRect((GAME_WIDTH / 3) * 2, (i * 60 + frameCount * gameSpeed) % GAME_HEIGHT - 30, 2, 20);
        }

        // Desenhar Player (Carro)
        drawCar(player.x, player.y, player.color, true);

        // Desenhar Obst√°culos
        obstacles.forEach(obs => {
            drawCar(obs.x, obs.y, obs.color, false);
        });
    }

    function drawCar(x, y, color, isPlayer) {
        ctx.fillStyle = color;
        // Corpo do carro
        ctx.fillRect(x, y, 40, 70);
        
        // Janelas
        ctx.fillStyle = "#111";
        ctx.fillRect(x + 5, y + 10, 30, 10); // Parabrisa traseiro
        ctx.fillRect(x + 5, y + 45, 30, 15); // Parabrisa dianteiro
        
        // Far√≥is (se for player, farois pra cima, inimigo pra baixo)
        if (isPlayer) {
            ctx.fillStyle = "#ffff00"; // Amarelo
            ctx.fillRect(x + 2, y, 10, 5);
            ctx.fillRect(x + 28, y, 10, 5);
            
            // Luz de freio (atr√°s)
            ctx.fillStyle = "#ff0000";
            ctx.fillRect(x + 2, y + 65, 10, 5);
            ctx.fillRect(x + 28, y + 65, 10, 5);
        } else {
             // Inimigos v√™m de frente? N√£o, √© tr√°fego no mesmo sentido
            ctx.fillStyle = "#330000"; // Escuro atr√°s
            ctx.fillRect(x + 2, y + 65, 10, 5);
            ctx.fillRect(x + 28, y + 65, 10, 5);
        }
    }

    function loop() {
        if (gameState === 'PLAYING') {
            update();
            draw();
            animationId = requestAnimationFrame(loop);
        }
    }

    function gameOver() {
        gameState = 'GAMEOVER';
        playerData.totalMoney += money;
        saveData();
        
        document.getElementById('finalScore').innerText = Math.floor(score / 10);
        document.getElementById('earnedMoney').innerText = money;
        document.getElementById('gameOverMenu').classList.remove('hidden');
    }

    function returnToMenu() {
        gameState = 'MENU';
        document.getElementById('gameOverMenu').classList.add('hidden');
        document.getElementById('shopMenu').classList.add('hidden');
        document.getElementById('startMenu').classList.remove('hidden');
        
        // Desenha um fundo est√°tico
        ctx.fillStyle = "#333";
        ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
    }

    // --- SISTEMA DE LOJA ---
    function openShop() {
        gameState = 'SHOP';
        document.getElementById('startMenu').classList.add('hidden');
        document.getElementById('shopMenu').classList.remove('hidden');
        updateShopUI();
    }

    function updateShopUI() {
        document.getElementById('shopMoney').innerText = playerData.totalMoney;
        
        // Renderizar Lista de Carros
        const list = document.getElementById('carList');
        list.innerHTML = '';
        
        CARS.forEach(car => {
            const isOwned = playerData.unlockedCars.includes(car.id);
            const isSelected = playerData.selectedCar === car.id;
            
            const div = document.createElement('div');
            div.className = `shop-item ${isSelected ? 'selected' : ''}`;
            
            let btnHTML = '';
            if (isSelected) {
                btnHTML = `<button disabled>Equipado</button>`;
            } else if (isOwned) {
                btnHTML = `<button onclick="selectCar(${car.id})">Equipar</button>`;
            } else {
                const canBuy = playerData.totalMoney >= car.price;
                btnHTML = `<button onclick="buyCar(${car.id})" ${canBuy ? '' : 'disabled'}>Comprar (R$ ${car.price})</button>`;
            }

            div.innerHTML = `
                <div style="width:30px; height:50px; background:${car.color}; margin:0 auto; border-radius:3px;"></div>
                <div style="font-weight:bold; margin:5px 0;">${car.name}</div>
                <div style="font-size:12px;">Speed: +${car.speedBonus}</div>
                ${btnHTML}
            `;
            list.appendChild(div);
        });

        // Atualizar Upgrade UI
        const upgradeCost = Math.floor(100 * Math.pow(1.5, playerData.moneyMultiplier));
        document.getElementById('mulLevel').innerText = playerData.moneyMultiplier;
        document.getElementById('mulCost').innerText = upgradeCost;
        document.getElementById('btnUpgrade').disabled = playerData.totalMoney < upgradeCost;
        document.getElementById('btnUpgrade').onclick = () => buyUpgrade(upgradeCost);
    }

    function buyCar(id) {
        const car = CARS.find(c => c.id === id);
        if (playerData.totalMoney >= car.price) {
            playerData.totalMoney -= car.price;
            playerData.unlockedCars.push(id);
            saveData();
            updateShopUI();
        }
    }

    function selectCar(id) {
        playerData.selectedCar = id;
        saveData();
        updateShopUI();
    }

    function buyUpgrade(cost) {
        if (playerData.totalMoney >= cost) {
            playerData.totalMoney -= cost;
            playerData.moneyMultiplier++;
            saveData();
            updateShopUI();
        }
    }

</script>

</body>
</html>